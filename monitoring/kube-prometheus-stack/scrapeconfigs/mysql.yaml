#todo вынести в k3s
apiVersion: monitoring.coreos.com/v1alpha1
kind: ScrapeConfig
metadata:
  name: mysql-exporter
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  jobName: mysql-exporter
  scrapeInterval: 15s
  metricsPath: '/metrics'
  scheme: HTTP
  staticConfigs:
  - targets:
    - 'mysql-exporter.monitoring.svc.cluster.local:9104'
    labels:
      group: 'mysql-exporter'
      environment: 'staging'
      host: 'home-vps'
      location: 'home'
  - targets:
    - 'mysql-exporter.monitoring.svc.cluster.local:9105'
    labels:
      group: 'mysql-exporter'
      environment: 'production'
      host: 'beget-vps'
      location: 'spb-beget'
  metricRelabelings:
    - sourceLabels: ["__name__"]
      regex: 'mysql_global_status_bytes_.*|mysql_global_status_innodb_data_written'
      action: drop

    - sourceLabels: ["__name__"]
      regex: '.*_bucket$'
      action: drop
    
    - sourceLabels: ["__name__"]
      regex: '.*_created$'
      action: drop
    
    - sourceLabels: ["__name__"]
      regex: '.*_(sum|count)$'
      action: drop
