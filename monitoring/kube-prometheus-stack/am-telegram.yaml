apiVersion: v1
kind: ConfigMap
metadata:
  name: alertmanager-templates
  namespace: monitoring
data:
  telegram.tmpl: |
    {{/* ---------------- ESCAPE ---------------- */}}
    {{ define "tg.escape" -}}
    {{- reReplaceAll "([_\\*\\[\\]\\(\\)~`>#+\\-=|{}.!])" "\\\\$1" . -}}
    {{- end }}

    {{/* ---------------- SEVERITY ICON ---------------- */}}
    {{ define "tg.icon" -}}
    {{- if eq .CommonLabels.severity "critical" -}}ğŸš¨
    {{- else if eq .CommonLabels.severity "warning" -}}âš ï¸
    {{- else -}}â„¹ï¸
    {{- end -}}
    {{- end }}

    {{/* ---------------- MAIN MESSAGE ---------------- */}}
    {{ define "telegram.message" }}

    {{ template "tg.icon" . }}
    *{{ template "tg.escape" .CommonLabels.alertname }}*

    {{ if eq .Status "firing" }}
    ğŸ”¥ *Ğ¿Ñƒ-Ğ¿Ñƒ-Ğ¿Ñƒ*
    {{ else }}
    âœ… *Ğ²ÑÑ‘ Ğ¾Ğº*
    {{ end }}

    {{ range .Alerts }}

    {{ if .Annotations.summary }}
    ğŸ“ {{ template "tg.escape" .Annotations.summary }}
    {{ end }}

    {{ if .Annotations.description }}
    {{ template "tg.escape" .Annotations.description }}
    {{ end }}

    {{ if .Labels.instance }}
    ğŸ–¥ Ğ¥Ğ¾ÑÑ‚: `{{ template "tg.escape" .Labels.instance }}`
    {{ end }}

    {{ if .Labels.namespace }}
    ğŸ“¦ Namespace: `{{ template "tg.escape" .Labels.namespace }}`
    {{ end }}

    {{ if .Labels.pod }}
    ğŸ“¦ Pod: `{{ template "tg.escape" .Labels.pod }}`
    {{ end }}

    {{ if .Annotations.runbook_url }}
    ğŸ“˜ Runbook:
    {{ .Annotations.runbook_url }}
    {{ end }}

    ğŸ” Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº:
    {{ .GeneratorURL }}

    ---
    {{ end }}

    {{ end }}
