# Альтернативный подход: Grafana Alerting с LogQL queries
# Эти алерты можно настроить в Grafana UI после получения эталонов логов
# или через Grafana Provisioning API

# Пример LogQL запросов для алертов (нужно будет уточнить после получения эталонов):

# 1. Immich - неуспешные попытки авторизации:
# sum(rate({namespace="apps", app=~"immich.*"} |~ ".*(login|auth|signin|sign-in|authentication).*" |~ ".*(fail|failed|error|401|403|unauthorized|invalid).*" [5m])) > 5

# 2. Immich - подозрительная активность:
# (
#   sum(rate({namespace="apps", app=~"immich.*"} |~ ".*(login|auth|signin|sign-in|authentication).*" [5m])) > 10
# ) and (
#   (
#     sum(rate({namespace="apps", app=~"immich.*"} |~ ".*(login|auth|signin|sign-in|authentication).*" |~ ".*(fail|failed|error|401|403|unauthorized|invalid).*" [5m])) / 
#     sum(rate({namespace="apps", app=~"immich.*"} |~ ".*(login|auth|signin|sign-in|authentication).*" [5m]))
#   ) > 0.5
# )

# 3. PhotoPrism - неуспешные попытки авторизации:
# sum(rate({namespace="apps", app="photoprism"} |~ ".*(login|auth|signin|sign-in|authentication|session).*" |~ ".*(fail|failed|error|401|403|unauthorized|invalid|denied).*" [5m])) > 5

# 4. PhotoPrism - подозрительная активность:
# (
#   sum(rate({namespace="apps", app="photoprism"} |~ ".*(login|auth|signin|sign-in|authentication|session).*" [5m])) > 10
# ) and (
#   (
#     sum(rate({namespace="apps", app="photoprism"} |~ ".*(login|auth|signin|sign-in|authentication|session).*" |~ ".*(fail|failed|error|401|403|unauthorized|invalid|denied).*" [5m])) / 
#     sum(rate({namespace="apps", app="photoprism"} |~ ".*(login|auth|signin|sign-in|authentication|session).*" [5m]))
#   ) > 0.5
# )

