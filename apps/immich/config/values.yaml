env:
  - name: IMMICH_LOG_LEVEL
    value: 'debug'
  - name: REDIS_HOSTNAME
    value: 'redis.apps.svc.cluster.local'
  - name: TRANSFORMERS_CACHE
    value: '/cache'
  - name: REDIS_DBINDEX
    value: "5"
  - name: REDIS_PORT
    value: "6379"
  - name: IMMICH_PORT
    value: "2283"
  - name: DB_HOSTNAME
    value: "pgvecto.apps.svc.cluster.local"
  - name: DB_PORT
    value: "5432"
  - name: IMMICH_MACHINE_LEARNING_URL
    value: '{{ printf "http://%s-machine-learning:3003" .Release.Name }}'
  - name: DB_DATABASE_NAME
    valueFrom:
      secretKeyRef:
        name: immich-secrets
        key: DB_DATABASE_NAME
  - name: DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: immich-secrets
        key: DB_PASSWORD
  - name: DB_USERNAME
    valueFrom:
      secretKeyRef:
        name: immich-secrets
        key: DB_USERNAME

immich:
  metrics:
    enabled: false
  persistence:
    library:
      existingClaim: immich-upload-pvc

server:
  enabled: true
  image:
    repository: ghcr.io/immich-app/immich-server
    tag: v2.2.1
    pullPolicy: IfNotPresent
  envFrom:
    - secretRef:
        name: immich-secrets
  persistence:
    backups:
      enabled: true
      existingClaim: immich-hdd-backups-pvc
      mountPath: /usr/src/app/upload/backups
    encoded-video:
      enabled: true
      existingClaim: immich-hdd-videos-pvc
      mountPath: /usr/src/app/upload/encoded-video
    library-dummy:
      enabled: true
      existingClaim: immich-hdd-library-pvc
      mountPath: /usr/src/app/upload/library
    upload:
      enabled: true
      existingClaim: immich-hdd-upload-pvc
      mountPath: /usr/src/app/upload/upload
    external:
      enabled: true
      existingClaim: immich-photos-pvc
      mountPath: /mnt/photos
  extraVolumeMounts:
  - name: dev-dri
    mountPath: /dev/dri
  extraVolumes:
    - name: dev-dri
      hostPath:
        path: /dev/dri
        type: Directory
  securityContext:
    privileged: true
    runAsUser: 0
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "3Gi"

machine-learning:
  enabled: true
  image:
    repository: ghcr.io/immich-app/immich-machine-learning
    tag: v2.2.0
    pullPolicy: IfNotPresent
  persistence:
    cache:
      enabled: true
      existingClaim: immich-fast-ml-pvc
      mountPath: "/cache"
      type: pvc
  envFrom:
    - secretRef:
        name: immich-secrets
  env:
    IMMICH_PORT: "3003"
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "2Gi"
