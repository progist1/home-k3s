apiVersion: k8up.io/v1
kind: Schedule
metadata:
  name: backup-important-daily-root
  namespace: apps
spec:
  backend:
    s3:
      endpoint: http://minio.infra.svc.cluster.local:9000
      bucket: k8up-backups
      accessKeyIDSecretRef:
        name: k8up-secrets
        key: access-key
      secretAccessKeySecretRef:
        name: k8up-secrets
        key: secret-key
    repoPasswordSecretRef:
      name: k8up-secrets
      key: password

  backup:
    schedule: "0 4 * * *"
    failedJobsHistoryLimit: 2
    successfulJobsHistoryLimit: 0
    promURL: "http://prometheus-pushgateway.monitoring.svc.cluster.local:9091"
    tags:
      - "minio"
      - "important"
      - "root"
    labelSelectors:
      - matchExpressions:
        - key: backup-level
          operator: In
          values:
            - important
            - daily
      - matchExpressions:
        - key: backup-user
          operator: In
          values:
            - root
    podSecurityContext:
      runAsUser: 0
      runAsGroup: 0
      fsGroup: 0

  prune:
    schedule: "0 6 * * *"
    retention:
      keepLast: 12
      keepDaily: 7
      keepWeekly: 4
      keepMonthly: 1



